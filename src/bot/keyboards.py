from typing import List, Optional

from aiogram.types import (
    InlineKeyboardButton,
    InlineKeyboardMarkup,
    KeyboardButton,
    ReplyKeyboardMarkup,
    ReplyKeyboardRemove,
)

from src.core.enums import (
    CarCondition,
    Education,
    Gender,
    HousingStatus,
    LoanType,
    MaritalStatus,
    ReceiveMethod,
    Region,
)


class Keyboards:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –±–æ—Ç–∞"""

    @staticmethod
    def phone_request() -> ReplyKeyboardMarkup:
        """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞"""
        keyboard = [
            [KeyboardButton(text="üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º", request_contact=True)]
        ]
        return ReplyKeyboardMarkup(
            keyboard=keyboard,
            resize_keyboard=True,
            one_time_keyboard=True
        )

    @staticmethod
    def remove() -> ReplyKeyboardRemove:
        """–£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã"""
        return ReplyKeyboardRemove()

    @staticmethod
    def language_choice() -> InlineKeyboardMarkup:
        """–í—ã–±–æ—Ä —è–∑—ã–∫–∞"""
        keyboard = [
            [
                InlineKeyboardButton(text="üá∑üá∫ –†—É—Å—Å–∫–∏–π", callback_data="lang:ru"),
                InlineKeyboardButton(text="üá∫üáø O'zbek", callback_data="lang:uz"),
            ]
        ]
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def main_menu() -> InlineKeyboardMarkup:
        """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
        keyboard = [
            [InlineKeyboardButton(text="üí≥ –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞", callback_data="new_loan")],
            [InlineKeyboardButton(text="üìã –ú–æ–∏ –∑–∞—è–≤–∫–∏", callback_data="my_applications")],
            [InlineKeyboardButton(text="üë§ –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ", callback_data="personal_data")],
            [InlineKeyboardButton(text="üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞", callback_data="referral")],
            [InlineKeyboardButton(text="‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏", callback_data="settings")],
        ]
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def loan_type_choice() -> InlineKeyboardMarkup:
        """–í—ã–±–æ—Ä —Ç–∏–ø–∞ –∫—Ä–µ–¥–∏—Ç–∞"""
        keyboard = [
            [InlineKeyboardButton(text="üöó –ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç", callback_data=f"loan_type:{LoanType.CARLOAN.value}")],
            [InlineKeyboardButton(text="üí∞ –ú–∏–∫—Ä–æ–∑–∞–π–º", callback_data=f"loan_type:{LoanType.MICROLOAN.value}")],
            [InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data="cancel")],
        ]
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def car_condition_choice() -> InlineKeyboardMarkup:
        """–í—ã–±–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª—è"""
        keyboard = [
            [InlineKeyboardButton(text="‚ú® –ù–æ–≤—ã–π", callback_data=f"car:{CarCondition.NEW.value}")],
            [InlineKeyboardButton(text="üöô –ü–æ–¥–µ—Ä–∂–∞–Ω–Ω—ã–π", callback_data=f"car:{CarCondition.USED.value}")],
        ]
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def receive_method_choice() -> InlineKeyboardMarkup:
        """–í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –ø–æ–ª—É—á–µ–Ω–∏—è"""
        keyboard = [
            [InlineKeyboardButton(text="üí≥ –ù–∞ –∫–∞—Ä—Ç—É", callback_data=f"receive:{ReceiveMethod.CARD.value}")],
            [InlineKeyboardButton(text="üíµ –ù–∞–ª–∏—á–Ω—ã–º–∏", callback_data=f"receive:{ReceiveMethod.CASH.value}")],
        ]
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def skip_other_payments() -> InlineKeyboardMarkup:
        """–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–≤–æ–¥ –¥—Ä—É–≥–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π"""
        keyboard = [
            [InlineKeyboardButton(text="‚û°Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å", callback_data="skip_other_payments")],
        ]
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def confirm_application() -> InlineKeyboardMarkup:
        """–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏"""
        keyboard = [
            [
                InlineKeyboardButton(text="‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å", callback_data="confirm_app"),
                InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data="cancel_app"),
            ]
        ]
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def application_actions(can_send: bool = True) -> InlineKeyboardMarkup:
        """–î–µ–π—Å—Ç–≤–∏—è —Å –∑–∞—è–≤–∫–æ–π"""
        keyboard = []
        
        if can_send:
            keyboard.append([InlineKeyboardButton(text="üè¶ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–∞–Ω–∫", callback_data="send_to_bank")])
        
        keyboard.extend([
            [InlineKeyboardButton(text="üë§ –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ", callback_data="fill_personal")],
            [InlineKeyboardButton(text="üîô –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="main_menu")],
        ])
        
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def gender_choice() -> InlineKeyboardMarkup:
        """–í—ã–±–æ—Ä –ø–æ–ª–∞"""
        keyboard = [
            [
                InlineKeyboardButton(text="üë® –ú—É–∂—Å–∫–æ–π", callback_data=f"gender:{Gender.MALE.value}"),
                InlineKeyboardButton(text="üë© –ñ–µ–Ω—Å–∫–∏–π", callback_data=f"gender:{Gender.FEMALE.value}"),
            ]
        ]
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def yes_no_choice(prefix: str) -> InlineKeyboardMarkup:
        """–í—ã–±–æ—Ä –¥–∞/–Ω–µ—Ç"""
        keyboard = [
            [
                InlineKeyboardButton(text="‚úÖ –î–∞", callback_data=f"{prefix}:yes"),
                InlineKeyboardButton(text="‚ùå –ù–µ—Ç", callback_data=f"{prefix}:no"),
            ]
        ]
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def marital_status_choice() -> InlineKeyboardMarkup:
        """–í—ã–±–æ—Ä —Å–µ–º–µ–π–Ω–æ–≥–æ –ø–æ–ª–æ–∂–µ–Ω–∏—è"""
        keyboard = [
            [InlineKeyboardButton(text="üë§ –•–æ–ª–æ—Å—Ç/–ù–µ –∑–∞–º—É–∂–µ–º", callback_data=f"marital:{MaritalStatus.SINGLE.value}")],
            [InlineKeyboardButton(text="üíë –ñ–µ–Ω–∞—Ç/–ó–∞–º—É–∂–µ–º", callback_data=f"marital:{MaritalStatus.MARRIED.value}")],
            [InlineKeyboardButton(text="üíî –†–∞–∑–≤–µ–¥–µ–Ω(–∞)", callback_data=f"marital:{MaritalStatus.DIVORCED.value}")],
            [InlineKeyboardButton(text="üïä –í–¥–æ–≤–µ—Ü/–í–¥–æ–≤–∞", callback_data=f"marital:{MaritalStatus.WIDOWED.value}")],
        ]
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def education_choice() -> InlineKeyboardMarkup:
        """–í—ã–±–æ—Ä –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è"""
        keyboard = [
            [InlineKeyboardButton(text="üìö –°—Ä–µ–¥–Ω–µ–µ", callback_data=f"edu:{Education.SECONDARY.value}")],
            [InlineKeyboardButton(text="üîß –°—Ä–µ–¥–Ω–µ–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ", callback_data=f"edu:{Education.VOCATIONAL.value}")],
            [InlineKeyboardButton(text="üìñ –ù–µ–ø–æ–ª–Ω–æ–µ –≤—ã—Å—à–µ–µ", callback_data=f"edu:{Education.INCOMPLETE_HIGHER.value}")],
            [InlineKeyboardButton(text="üéì –í—ã—Å—à–µ–µ", callback_data=f"edu:{Education.HIGHER.value}")],
            [InlineKeyboardButton(text="üéìüéì –ü–æ—Å–ª–µ–≤—É–∑–æ–≤—Å–∫–æ–µ", callback_data=f"edu:{Education.POSTGRADUATE.value}")],
        ]
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def housing_status_choice() -> InlineKeyboardMarkup:
        """–í—ã–±–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ –∂–∏–ª—å—è"""
        keyboard = [
            [InlineKeyboardButton(text="üè† –°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ", callback_data=f"house:{HousingStatus.OWN.value}")],
            [InlineKeyboardButton(text="üè¶ –°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ (–∏–ø–æ—Ç–µ–∫–∞)", callback_data=f"house:{HousingStatus.OWN_WITH_MORTGAGE.value}")],
            [InlineKeyboardButton(text="üè¢ –ê—Ä–µ–Ω–¥–∞", callback_data=f"house:{HousingStatus.RENT.value}")],
            [InlineKeyboardButton(text="üë®‚Äçüë©‚Äçüëß –£ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤", callback_data=f"house:{HousingStatus.RELATIVES.value}")],
        ]
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def region_choice() -> InlineKeyboardMarkup:
        """–í—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞ (–ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å)"""
        regions = [
            ("üèô –¢–∞—à–∫–µ–Ω—Ç", Region.TASHKENT.value),
            ("üåÜ –¢–∞—à–∫–µ–Ω—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", Region.TASHKENT_REGION.value),
            ("–ê–Ω–¥–∏–∂–∞–Ω", Region.ANDIJAN.value),
            ("–ë—É—Ö–∞—Ä–∞", Region.BUKHARA.value),
            ("–§–µ—Ä–≥–∞–Ω–∞", Region.FERGANA.value),
            ("–î–∂–∏–∑–∞–∫", Region.JIZZAKH.value),
            ("–ù–∞–º–∞–Ω–≥–∞–Ω", Region.NAMANGAN.value),
        ]
        
        keyboard = []
        for name, value in regions:
            keyboard.append([InlineKeyboardButton(text=name, callback_data=f"region:{value}")])
        
        keyboard.append([InlineKeyboardButton(text="‚û°Ô∏è –î–∞–ª–µ–µ", callback_data="region_more")])
        
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def region_choice_more() -> InlineKeyboardMarkup:
        """–í—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞ (–≤—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å)"""
        regions = [
            ("–ù–∞–≤–æ–∏", Region.NAVOIY.value),
            ("–ö–∞—à–∫–∞–¥–∞—Ä—å—è", Region.QASHQADARYO.value),
            ("–°–∞–º–∞—Ä–∫–∞–Ω–¥", Region.SAMARKAND.value),
            ("–°—ã—Ä–¥–∞—Ä—å—è", Region.SIRDARYO.value),
            ("–°—É—Ä—Ö–∞–Ω–¥–∞—Ä—å—è", Region.SURXONDARYO.value),
            ("–•–æ—Ä–µ–∑–º", Region.XORAZM.value),
            ("–ö–∞—Ä–∞–∫–∞–ª–ø–∞–∫—Å—Ç–∞–Ω", Region.KARAKALPAKSTAN.value),
        ]
        
        keyboard = []
        for name, value in regions:
            keyboard.append([InlineKeyboardButton(text=name, callback_data=f"region:{value}")])
        
        keyboard.append([InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data="region_back")])
        
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def back_button(callback_data: str = "back") -> InlineKeyboardMarkup:
        """–ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥"""
        keyboard = [
            [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=callback_data)]
        ]
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def cancel_button() -> InlineKeyboardMarkup:
        """–ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã"""
        keyboard = [
            [InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∞", callback_data="cancel")]
        ]
        return InlineKeyboardMarkup(inline_keyboard=keyboard)

    @staticmethod
    def referral_menu(share_url: str) -> InlineKeyboardMarkup:
        """–ú–µ–Ω—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã"""
        keyboard = [
            [InlineKeyboardButton(text="üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è", url=share_url)],
            [InlineKeyboardButton(text="üîô –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="main_menu")],
        ]
        return InlineKeyboardMarkup(inline_keyboard=keyboard)