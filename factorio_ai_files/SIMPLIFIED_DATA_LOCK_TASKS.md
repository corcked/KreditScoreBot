# –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ç–∞—Å–∫-–ª–∏—Å—Ç: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥

–í–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ –≤ –ë–î, –∏—Å–ø–æ–ª—å–∑—É–µ–º **–ø—Ä–æ—Å—Ç—É—é –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª–µ–π**:

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏** - –µ—Å–ª–∏ –ø–æ–ª–µ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ (–Ω–µ NULL), —Ç–æ –æ–Ω–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º"
2. **UI –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç –æ–ø—Ü–∏–π –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
3. **–ò—Å–∫–ª—é—á–µ–Ω–∏—è** - –¥–æ—Ö–æ–¥ –∏ –∫—Ä–µ–¥–∏—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞—é—Ç—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–º–∏
4. **–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ** - –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –ø–æ—á–µ–º—É –ø–æ–ª–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:
- ‚úÖ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î
- ‚úÖ –ù–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

## –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ (1 –¥–µ–Ω—å)

#### 1.1 –°–æ–∑–¥–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏
**–§–∞–π–ª:** `src/core/field_protection.py`

```python
from typing import List, Dict, Optional
from src.db.models import PersonalData
from src.core.enums import *

class FieldProtectionManager:
    """–ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞—â–∏—Ç—ã –ø–æ–ª–µ–π –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è"""
    
    # –ü–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
    PROTECTED_FIELDS = {
        'age': '–í–æ–∑—Ä–∞—Å—Ç',
        'gender': '–ü–æ–ª',
        'work_experience_months': '–°—Ç–∞–∂ —Ä–∞–±–æ—Ç—ã',
        'address_stability_years': '–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∞–¥—Ä–µ—Å–∞',
        'housing_status': '–°—Ç–∞—Ç—É—Å –∂–∏–ª—å—è',
        'marital_status': '–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ',
        'education': '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ',
        'closed_loans_count': '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫—Ä—ã—Ç—ã—Ö –∑–∞–π–º–æ–≤',
        'region': '–†–µ–≥–∏–æ–Ω –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è',
        'device_type': '–¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞'
    }
    
    # –ü–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
    ALWAYS_EDITABLE_FIELDS = {
        'monthly_income': '–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–æ—Ö–æ–¥',
        'has_other_loans': '–ù–∞–ª–∏—á–∏–µ –¥—Ä—É–≥–∏—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤',
        'other_loans_monthly_payment': '–ü–ª–∞—Ç–µ–∂–∏ –ø–æ –¥—Ä—É–≥–∏–º –∫—Ä–µ–¥–∏—Ç–∞–º'
    }
    
    @classmethod
    def is_field_protected(cls, personal_data: PersonalData, field_name: str) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞—â–∏—â–µ–Ω–æ –ª–∏ –ø–æ–ª–µ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
        
        Args:
            personal_data: –û–±—ä–µ–∫—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            field_name: –ò–º—è –ø–æ–ª—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            
        Returns:
            True –µ—Å–ª–∏ –ø–æ–ª–µ –∑–∞—â–∏—â–µ–Ω–æ (–∑–∞–ø–æ–ª–Ω–µ–Ω–æ –∏ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ)
        """
        # –í—Å–µ–≥–¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞—â–∏—â–µ–Ω—ã
        if field_name in cls.ALWAYS_EDITABLE_FIELDS:
            return False
            
        # –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –ø–æ–ª—è –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –µ—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
        if field_name in cls.PROTECTED_FIELDS:
            field_value = getattr(personal_data, field_name, None)
            return field_value is not None
            
        return False
    
    @classmethod
    def get_protected_fields(cls, personal_data: PersonalData) -> List[str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π"""
        protected = []
        for field_name in cls.PROTECTED_FIELDS:
            if cls.is_field_protected(personal_data, field_name):
                protected.append(field_name)
        return protected
    
    @classmethod
    def get_editable_fields(cls, personal_data: PersonalData) -> List[str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
        editable = []
        
        # –í—Å–µ–≥–¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è
        editable.extend(cls.ALWAYS_EDITABLE_FIELDS.keys())
        
        # –ù–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –ø–æ–ª—è
        for field_name in cls.PROTECTED_FIELDS:
            if not cls.is_field_protected(personal_data, field_name):
                editable.append(field_name)
                
        return editable
    
    @classmethod
    def get_field_status(cls, personal_data: PersonalData) -> Dict[str, Dict[str, any]]:
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –ø–æ–ª–µ–π
        
        Returns:
            Dict —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–∞–∂–¥–æ–º –ø–æ–ª–µ:
            {
                'field_name': {
                    'is_protected': bool,
                    'is_filled': bool,
                    'display_name': str,
                    'current_value': any
                }
            }
        """
        status = {}
        
        all_fields = {**cls.PROTECTED_FIELDS, **cls.ALWAYS_EDITABLE_FIELDS}
        
        for field_name, display_name in all_fields.items():
            field_value = getattr(personal_data, field_name, None)
            
            status[field_name] = {
                'is_protected': cls.is_field_protected(personal_data, field_name),
                'is_filled': field_value is not None,
                'display_name': display_name,
                'current_value': field_value,
                'is_always_editable': field_name in cls.ALWAYS_EDITABLE_FIELDS
            }
            
        return status
    
    @classmethod
    def get_protection_reason(cls, field_name: str, translate=None) -> str:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –ø–æ—á–µ–º—É –ø–æ–ª–µ –∑–∞—â–∏—â–µ–Ω–æ"""
        _ = translate if translate else lambda x: x
        
        if field_name in cls.PROTECTED_FIELDS:
            return _(
                "This field is protected because it's already filled and affects "
                "your credit score. This ensures the reliability of your assessment."
            )
        
        return _("This field is protected.")
```

### –≠—Ç–∞–ø 2: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è UI (1-2 –¥–Ω—è)

#### 2.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ö–µ–Ω–¥–ª–µ—Ä–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
**–§–∞–π–ª:** `src/bot/handlers/personal_data.py`

```python
from src.core.field_protection import FieldProtectionManager

@router.callback_query(F.data == "edit_personal_data")
async def show_personal_data_menu(callback: types.CallbackQuery, _: callable):
    """–ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
    user_id = callback.from_user.id
    
    async with get_db_context() as db:
        # –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        result = await db.execute(
            select(PersonalData).where(PersonalData.user_id == user_id)
        )
        personal_data = result.scalar_one_or_none()
        
        if not personal_data:
            await callback.message.edit_text(
                f"‚ùå {_('Personal data not found')}",
                reply_markup=Keyboards.back_to_menu(_)
            )
            return
        
        # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–ª–µ–π
        field_status = FieldProtectionManager.get_field_status(personal_data)
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é —Å —É—á–µ—Ç–æ–º –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
        await show_data_menu_with_protection(callback, field_status, _)

async def show_data_menu_with_protection(
    callback: types.CallbackQuery, 
    field_status: Dict[str, Dict[str, any]], 
    _: callable
):
    """–ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é –¥–∞–Ω–Ω—ã—Ö —Å —É—á–µ—Ç–æ–º –∑–∞—â–∏—Ç—ã –ø–æ–ª–µ–π"""
    
    message = f"üë§ **{_('Personal Data')}**\n\n"
    
    # –†–∞–∑–¥–µ–ª—è–µ–º –ø–æ–ª—è –Ω–∞ –≥—Ä—É–ø–ø—ã
    protected_fields = []
    editable_fields = []
    filled_fields = []
    
    for field_name, status in field_status.items():
        if status['is_protected']:
            protected_fields.append((field_name, status))
        elif status['is_filled']:
            filled_fields.append((field_name, status))
        else:
            editable_fields.append((field_name, status))
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    if filled_fields or protected_fields:
        message += f"üìã **{_('Current Data')}:**\n"
        
        for field_name, status in filled_fields + protected_fields:
            value = format_field_value(status['current_value'], field_name)
            icon = "üîí" if status['is_protected'] else "‚úÖ"
            message += f"{icon} {status['display_name']}: {value}\n"
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    if editable_fields:
        message += f"\n‚úèÔ∏è **{_('Available for editing')}:**\n"
        for field_name, status in editable_fields:
            if not status['is_filled']:
                message += f"üìù {status['display_name']}: {_('Not filled')}\n"
    
    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –ø–æ–ª—è—Ö
    if protected_fields:
        message += f"\nüîí **{_('Protected fields')}:** {len(protected_fields)}\n"
        message += f"üí° {_('These fields cannot be changed as they affect your credit score')}\n"
    
    await callback.message.edit_text(
        message,
        reply_markup=Keyboards.personal_data_menu_protected(field_status, _)
    )

def format_field_value(value: any, field_name: str) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"""
    if value is None:
        return "–ù–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ"
    
    # –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª–µ–π
    if field_name == 'gender':
        return "–ú—É–∂—Å–∫–æ–π" if value == Gender.MALE else "–ñ–µ–Ω—Å–∫–∏–π"
    elif field_name == 'monthly_income':
        return f"{value:,.0f} —Å—É–º".replace(",", " ")
    elif field_name == 'has_other_loans':
        return "–î–∞" if value else "–ù–µ—Ç"
    elif field_name in ['work_experience_months', 'address_stability_years']:
        if field_name == 'work_experience_months':
            return f"{value} –º–µ—Å."
        else:
            return f"{value} –ª–µ—Ç"
    elif isinstance(value, Enum):
        return value.value.replace('_', ' ').title()
    
    return str(value)
```

#### 2.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä
**–§–∞–π–ª:** `src/bot/keyboards.py` (–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ)

```python
@staticmethod
def personal_data_menu_protected(field_status: Dict[str, Dict[str, any]], translate=None):
    """–ú–µ–Ω—é –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å —É—á–µ—Ç–æ–º –∑–∞—â–∏—Ç—ã –ø–æ–ª–µ–π"""
    _ = translate if translate else lambda x: x
    
    keyboard = InlineKeyboardBuilder()
    
    # –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª–µ–π
    editable_fields = [
        (name, status) for name, status in field_status.items() 
        if not status['is_protected']
    ]
    
    if editable_fields:
        keyboard.button(
            text=f"‚úèÔ∏è {_('Edit available fields')}",
            callback_data="edit_available_fields"
        )
    
    # –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    protected_count = sum(1 for s in field_status.values() if s['is_protected'])
    if protected_count > 0:
        keyboard.button(
            text=f"üîí {_('View protected data')} ({protected_count})",
            callback_data="view_protected_data"
        )
    
    # –ö–Ω–æ–ø–∫–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –∑–∞—â–∏—Ç—ã
    if protected_count > 0:
        keyboard.button(
            text=f"‚ùì {_('Why are fields protected?')}",
            callback_data="explain_protection"
        )
    
    keyboard.button(text=f"‚óÄÔ∏è {_('Back')}", callback_data="main_menu")
    keyboard.adjust(1)
    
    return keyboard.as_markup()

@staticmethod
def editable_fields_menu(field_status: Dict[str, Dict[str, any]], translate=None):
    """–ú–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª–µ–π"""
    _ = translate if translate else lambda x: x
    
    keyboard = InlineKeyboardBuilder()
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª–µ–π
    for field_name, status in field_status.items():
        if not status['is_protected']:
            icon = "üí∞" if field_name == 'monthly_income' else "üìù"
            text = f"{icon} {status['display_name']}"
            
            if status['is_filled']:
                text += " ‚úÖ"
            
            keyboard.button(
                text=text,
                callback_data=f"edit_field:{field_name}"
            )
    
    keyboard.button(text=f"‚óÄÔ∏è {_('Back')}", callback_data="edit_personal_data")
    keyboard.adjust(1)
    
    return keyboard.as_markup()
```

### –≠—Ç–∞–ø 3: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (0.5 –¥–Ω—è)

#### 3.1 –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∑–∞—â–∏—Ç—ã –ø–æ–ª–µ–π
**–§–∞–π–ª:** `src/bot/handlers/personal_data.py` (–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ)

```python
@router.callback_query(F.data == "explain_protection")
async def explain_field_protection(callback: types.CallbackQuery, _: callable):
    """–û–±—ä—è—Å–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∑–∞—â–∏—Ç—ã –ø–æ–ª–µ–π"""
    
    message = f"üîí **{_('Field Protection System')}**\n\n"
    
    message += f"**{_('Why are some fields protected?')}**\n"
    message += f"‚Ä¢ {_('Filled fields affect your credit score')}\n"
    message += f"‚Ä¢ {_('This prevents score manipulation')}\n"
    message += f"‚Ä¢ {_('Ensures assessment reliability')}\n\n"
    
    message += f"**{_('What you can always edit:')}**\n"
    message += f"üí∞ {_('Monthly income')}\n"
    message += f"üè¶ {_('Information about other loans')}\n\n"
    
    message += f"**{_('What gets protected:')}**\n"
    message += f"üë§ {_('Personal information (age, gender)')}\n"
    message += f"üè† {_('Housing and family status')}\n"
    message += f"üéì {_('Education and work experience')}\n"
    message += f"üìç {_('Location and device type')}\n\n"
    
    message += f"üí° {_('Tip: Fill all fields carefully before first scoring calculation!')}"
    
    await callback.message.edit_text(
        message,
        reply_markup=Keyboards.back_to_personal_data(_)
    )

@router.callback_query(F.data == "view_protected_data")
async def view_protected_data(callback: types.CallbackQuery, _: callable):
    """–ü–æ–∫–∞–∑–∞—Ç—å –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"""
    user_id = callback.from_user.id
    
    async with get_db_context() as db:
        result = await db.execute(
            select(PersonalData).where(PersonalData.user_id == user_id)
        )
        personal_data = result.scalar_one_or_none()
        
        if not personal_data:
            await callback.answer(_("Data not found"))
            return
        
        field_status = FieldProtectionManager.get_field_status(personal_data)
        protected_fields = [
            (name, status) for name, status in field_status.items() 
            if status['is_protected']
        ]
        
        if not protected_fields:
            await callback.answer(_("No protected fields"))
            return
        
        message = f"üîí **{_('Protected Data')}**\n\n"
        message += f"{_('These fields cannot be changed:')}\n\n"
        
        for field_name, status in protected_fields:
            value = format_field_value(status['current_value'], field_name)
            message += f"üîí **{status['display_name']}**: {value}\n"
        
        message += f"\nüí° {_('These fields are locked because they affect your credit score.')}"
        
        await callback.message.edit_text(
            message,
            reply_markup=Keyboards.back_to_personal_data(_)
        )

@router.callback_query(F.data.startswith("edit_field:"))
async def handle_field_edit_attempt(callback: types.CallbackQuery, _: callable):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ø—ã—Ç–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—è"""
    field_name = callback.data.split(":")[1]
    user_id = callback.from_user.id
    
    async with get_db_context() as db:
        result = await db.execute(
            select(PersonalData).where(PersonalData.user_id == user_id)
        )
        personal_data = result.scalar_one_or_none()
        
        if not personal_data:
            await callback.answer(_("Data not found"))
            return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞—â–∏—â–µ–Ω–æ –ª–∏ –ø–æ–ª–µ
        if FieldProtectionManager.is_field_protected(personal_data, field_name):
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞—â–∏—Ç–µ
            reason = FieldProtectionManager.get_protection_reason(field_name, _)
            await callback.answer(
                f"üîí {reason}",
                show_alert=True
            )
            return
        
        # –ï—Å–ª–∏ –ø–æ–ª–µ –Ω–µ –∑–∞—â–∏—â–µ–Ω–æ, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        await start_field_editing(callback, field_name, personal_data, _)
```

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1 –¥–µ–Ω—å)

#### 4.1 Unit —Ç–µ—Å—Ç—ã
**–§–∞–π–ª:** `tests/unit/test_field_protection.py`

```python
import pytest
from src.core.field_protection import FieldProtectionManager
from src.db.models import PersonalData
from src.core.enums import Gender, Education, Region

class TestFieldProtectionManager:
    """–¢–µ—Å—Ç—ã –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∑–∞—â–∏—Ç—ã –ø–æ–ª–µ–π"""
    
    def test_is_field_protected_empty_field(self):
        """–¢–µ—Å—Ç: –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ –Ω–µ –∑–∞—â–∏—â–µ–Ω–æ"""
        personal_data = PersonalData()
        assert not FieldProtectionManager.is_field_protected(personal_data, 'age')
    
    def test_is_field_protected_filled_field(self):
        """–¢–µ—Å—Ç: –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –∑–∞—â–∏—â–∞–µ–º–æ–µ –ø–æ–ª–µ –∑–∞—â–∏—â–µ–Ω–æ"""
        personal_data = PersonalData(age=30)
        assert FieldProtectionManager.is_field_protected(personal_data, 'age')
    
    def test_is_field_protected_always_editable(self):
        """–¢–µ—Å—Ç: –≤—Å–µ–≥–¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ –ø–æ–ª–µ –Ω–µ –∑–∞—â–∏—â–µ–Ω–æ"""
        personal_data = PersonalData(monthly_income=100000)
        assert not FieldProtectionManager.is_field_protected(personal_data, 'monthly_income')
    
    def test_get_protected_fields_empty_data(self):
        """–¢–µ—Å—Ç: –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ - –Ω–µ—Ç –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π"""
        personal_data = PersonalData()
        protected = FieldProtectionManager.get_protected_fields(personal_data)
        assert protected == []
    
    def test_get_protected_fields_some_filled(self):
        """–¢–µ—Å—Ç: —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"""
        personal_data = PersonalData(
            age=30,
            gender=Gender.FEMALE,
            monthly_income=100000  # –í—Å–µ–≥–¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ
        )
        protected = FieldProtectionManager.get_protected_fields(personal_data)
        assert 'age' in protected
        assert 'gender' in protected
        assert 'monthly_income' not in protected
    
    def test_get_editable_fields(self):
        """–¢–µ—Å—Ç: –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª–µ–π"""
        personal_data = PersonalData(
            age=30,  # –ó–∞—â–∏—â–µ–Ω–æ
            monthly_income=100000  # –í—Å–µ–≥–¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ
        )
        editable = FieldProtectionManager.get_editable_fields(personal_data)
        
        # –î–æ—Ö–æ–¥ –≤—Å–µ–≥–¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π
        assert 'monthly_income' in editable
        assert 'has_other_loans' in editable
        assert 'other_loans_monthly_payment' in editable
        
        # –í–æ–∑—Ä–∞—Å—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω - –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π
        assert 'age' not in editable
        
        # –ü–æ–ª –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π
        assert 'gender' in editable
    
    def test_get_field_status(self):
        """–¢–µ—Å—Ç: –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö –ø–æ–ª–µ–π"""
        personal_data = PersonalData(
            age=30,
            monthly_income=100000
        )
        status = FieldProtectionManager.get_field_status(personal_data)
        
        # –í–æ–∑—Ä–∞—Å—Ç –∑–∞—â–∏—â–µ–Ω
        assert status['age']['is_protected'] is True
        assert status['age']['is_filled'] is True
        assert status['age']['current_value'] == 30
        
        # –î–æ—Ö–æ–¥ –Ω–µ –∑–∞—â–∏—â–µ–Ω
        assert status['monthly_income']['is_protected'] is False
        assert status['monthly_income']['is_filled'] is True
        assert status['monthly_income']['is_always_editable'] is True
        
        # –ü–æ–ª –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω
        assert status['gender']['is_protected'] is False
        assert status['gender']['is_filled'] is False
        assert status['gender']['current_value'] is None
    
    def test_get_protection_reason(self):
        """–¢–µ—Å—Ç: –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –∑–∞—â–∏—Ç—ã"""
        reason = FieldProtectionManager.get_protection_reason('age')
        assert 'credit score' in reason.lower()
        assert 'reliability' in reason.lower()
```

#### 4.2 Integration —Ç–µ—Å—Ç—ã
**–§–∞–π–ª:** `tests/integration/test_personal_data_protection.py`

```python
import pytest
from unittest.mock import AsyncMock, patch
from src.bot.handlers.personal_data import show_personal_data_menu
from src.core.field_protection import FieldProtectionManager
from src.db.models import PersonalData
from src.core.enums import Gender

class TestPersonalDataProtectionUI:
    """–¢–µ—Å—Ç—ã UI –∑–∞—â–∏—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
    
    @pytest.mark.asyncio
    async def test_show_menu_with_empty_data(self, mock_callback, mock_db):
        """–¢–µ—Å—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ–Ω—é —Å –ø—É—Å—Ç—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏"""
        personal_data = PersonalData()
        
        with patch('src.bot.handlers.personal_data.get_db_context') as mock_get_db:
            mock_get_db.return_value.__aenter__.return_value = mock_db
            mock_db.execute.return_value.scalar_one_or_none.return_value = personal_data
            
            await show_personal_data_menu(mock_callback, lambda x: x)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–ª—è—Ö
            call_args = mock_callback.message.edit_text.call_args
            message_text = call_args[0][0]
            
            assert "Available for editing" in message_text
            assert "Protected fields" not in message_text
    
    @pytest.mark.asyncio
    async def test_show_menu_with_protected_data(self, mock_callback, mock_db):
        """–¢–µ—Å—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ–Ω—é —Å –∑–∞—â–∏—â–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏"""
        personal_data = PersonalData(
            age=30,
            gender=Gender.FEMALE,
            monthly_income=100000
        )
        
        with patch('src.bot.handlers.personal_data.get_db_context') as mock_get_db:
            mock_get_db.return_value.__aenter__.return_value = mock_db
            mock_db.execute.return_value.scalar_one_or_none.return_value = personal_data
            
            await show_personal_data_menu(mock_callback, lambda x: x)
            
            call_args = mock_callback.message.edit_text.call_args
            message_text = call_args[0][0]
            
            assert "Protected fields" in message_text
            assert "üîí" in message_text
            assert "30" in message_text  # –í–æ–∑—Ä–∞—Å—Ç
    
    @pytest.mark.asyncio
    async def test_field_edit_attempt_protected(self, mock_callback, mock_db):
        """–¢–µ—Å—Ç –ø–æ–ø—ã—Ç–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—è"""
        from src.bot.handlers.personal_data import handle_field_edit_attempt
        
        personal_data = PersonalData(age=30)
        mock_callback.data = "edit_field:age"
        
        with patch('src.bot.handlers.personal_data.get_db_context') as mock_get_db:
            mock_get_db.return_value.__aenter__.return_value = mock_db
            mock_db.execute.return_value.scalar_one_or_none.return_value = personal_data
            
            await handle_field_edit_attempt(mock_callback, lambda x: x)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–∫–∞–∑–∞–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
            mock_callback.answer.assert_called_once()
            call_args = mock_callback.answer.call_args
            assert "üîí" in call_args[0][0]
            assert call_args[1]['show_alert'] is True
    
    @pytest.mark.asyncio
    async def test_field_edit_attempt_editable(self, mock_callback, mock_db):
        """–¢–µ—Å—Ç –ø–æ–ø—ã—Ç–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –ø–æ–ª—è"""
        from src.bot.handlers.personal_data import handle_field_edit_attempt
        
        personal_data = PersonalData(monthly_income=100000)
        mock_callback.data = "edit_field:monthly_income"
        
        with patch('src.bot.handlers.personal_data.get_db_context') as mock_get_db:
            mock_get_db.return_value.__aenter__.return_value = mock_db
            mock_db.execute.return_value.scalar_one_or_none.return_value = personal_data
            
            with patch('src.bot.handlers.personal_data.start_field_editing') as mock_start:
                await handle_field_edit_attempt(mock_callback, lambda x: x)
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–∞—á–∞–ª–æ—Å—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                mock_start.assert_called_once()
                mock_callback.answer.assert_not_called()
```

## –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
```
src/core/field_protection.py                   # –õ–æ–≥–∏–∫–∞ –∑–∞—â–∏—Ç—ã –ø–æ–ª–µ–π (–ø—Ä–æ—Å—Ç–∞—è)
tests/unit/test_field_protection.py            # Unit —Ç–µ—Å—Ç—ã
tests/integration/test_personal_data_protection.py  # Integration —Ç–µ—Å—Ç—ã
```

### –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã:
```
src/bot/handlers/personal_data.py              # UI —Å –∑–∞—â–∏—Ç–æ–π –ø–æ–ª–µ–π
src/bot/keyboards.py                           # –ù–æ–≤—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

### –°–ª–æ–∂–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (—Å –ë–î):
- ‚ùå –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
- ‚ùå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
- ‚ùå –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞
- ‚úÖ –ü–æ–ª–Ω—ã–π audit trail
- ‚úÖ –ì–∏–±–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

### –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
- ‚úÖ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ë–î
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- ‚ùå –ù–µ—Ç audit trail
- ‚ùå –ú–µ–Ω–µ–µ –≥–∏–±–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞

## –í—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 2-3 –¥–Ω—è
- –≠—Ç–∞–ø 1 (–õ–æ–≥–∏–∫–∞): 1 –¥–µ–Ω—å
- –≠—Ç–∞–ø 2 (UI): 1-2 –¥–Ω—è  
- –≠—Ç–∞–ø 3 (–°–æ–æ–±—â–µ–Ω–∏—è): 0.5 –¥–Ω—è
- –≠—Ç–∞–ø 4 (–¢–µ—Å—Ç—ã): 1 –¥–µ–Ω—å

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- [ ] –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è (–∫—Ä–æ–º–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π) –Ω–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç–∞—Ç—É—Å –ø–æ–ª–µ–π (–∑–∞—â–∏—â–µ–Ω–æ/–¥–æ—Å—Ç—É–ø–Ω–æ)
- [ ] –î–æ—Ö–æ–¥ –∏ –∫—Ä–µ–¥–∏—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤—Å–µ–≥–¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã
- [ ] –ï—Å—Ç—å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∑–∞—â–∏—Ç—ã
- [ ] –ü–æ–ø—ã—Ç–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- [ ] Unit —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç >95% –ª–æ–≥–∏–∫–∏ –∑–∞—â–∏—Ç—ã
- [ ] Integration —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç UI
- [ ] –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ —É—Ö—É–¥—à–∞–µ—Ç—Å—è

## –í—ã–≤–æ–¥

–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ **–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—â–µ** –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç —Ç–æ–π –∂–µ —Ü–µ–ª–∏ - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–∫–æ—Ä–∏–Ω–≥–µ. –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î –∏ –±—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.